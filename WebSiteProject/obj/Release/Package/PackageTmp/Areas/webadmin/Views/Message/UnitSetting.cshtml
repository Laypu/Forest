@model MessageUnitSettingModel
<script src="@Url.Content("~/Scripts/datatable.js")"></script>
<script src="@Url.Content("~/Scripts/custom.js")"></script>
<!--page bar start-->
<div class="page-bar all_width">
    <ul class="page-breadcrumb">
        <li>
            <span href="#">Home</span>
            <i class="fa fa-circle"></i>
            <span href="#">訊息管理</span>
            <i class="fa fa-circle"></i>
            <span href="#">單元設定</span>
        </li>
    </ul>
</div>
<!--page bar end-->
<!--message start-->
<div class="member_title">@ViewBag.Title</div>
<form  class="form-horizontal form-bordered" method="Post" id="editform" action='@Url.Action("SaveUnit")' >
    <div class="table-toolbar">
        <div class="col-md-6 col-sm-12 col-xs-12">
            <div class="display_inline">
                <p class="btn_03">管理項目</p>
                <select class="form_02" id="sel_unit">
                    <option value="1" >訊息管理</option>
                    <option value="2" selected>單元設定</option>
                    <option value="3">SEO設定</option>
                </select>
            </div>
        </div>

    </div>
    @Html.HiddenFor(Model => Model.MainID)
    @Html.HiddenFor(Model => Model.ID)
    <div class="portlet light form-fit bordered" id="div_seo">
        <div class="portlet-body form">
            <div class="form-horizontal form-bordered">
                <div class="form-body" id="form-body">
                    <div class="form-group  ">
                        <div class="col-md-2 col-sm-2 col-xs-12 bg-grey_1 search_item">功能提供</div>
                        <div class="col-md-10 col-sm-10 col-xs-12 bg-white mobile_white">
                            <div class="input-group input-large">
                                @Html.CheckBoxFor(m => m.IsRSS, new { @class = "checkboxes", style = "margin-left:0px" })<span>RSS</span>
                                @Html.CheckBoxFor(m => m.IsForward, new { @class = "checkboxes", style = "margin-left:20px" })<span>轉寄好友</span>
                                @Html.CheckBoxFor(m => m.IsPrint, new { @class = "checkboxes", style = "margin-left:20px" })<span>友善列印</span>
                                @Html.CheckBoxFor(m => m.IsShare, new { @class = "checkboxes", style = "margin-left:20px" })<span>分享</span>
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-md-2 col-sm-2 col-xs-12 bg-grey_1 search_item">前台列表顯示設定</div>
                        <div class="col-md-10 col-sm-10 col-xs-12 bg-white mobile_white">
                            <table class="table table-bordered table-hover" border="0" cellspacing="0" cellpadding="0"  id="eventtable">
                                <thead>
                                    <tr class="bg-grey_1" filed-class='odd gradeX'>
                                        <th filed-name='Sort' width="40px" class="text-center" filed-type='numbertextcheck' filed-item-class="sortedit">排序</th>
                                        <th filed-name='ColumnName' class="text-center">名稱</th>
                                        <th width="80px" filed-name='Show' class="text-center" filed-type='checkbox' filed-item-class="chkstatus">顯示</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @{
                                        for (var idx = 0; idx < Model.UnitSettingColumnList.Count(); idx++)
                                        {
                                            <tr class="odd gradeX" id="tr_@idx" seqidx="@(idx+1)">
                                                <td class="text-center delete_th">
                                                    <input type="text" class="form-control input-xsmall sequence_list" value="@(idx+1)">
                                                </td>
                                                  <td class="text-center columnname">@Model.UnitSettingColumnList[idx].Name</td>
                                                  <td class="text-center"><label class="mt-checkbox mt-checkbox-single mt-checkbox-outline">  
                                                      <input class="chkstatus" type="checkbox" @(Model.UnitSettingColumnList[idx].Sellected==1?"checked='checked'":"")><span></span></label>
                                                 </td>
                                            </tr>
                                        }
                                    }
                                </tbody>
                            </table>
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="col-md-2 col-sm-2 col-xs-12 bg-grey_1 search_item">每頁顯示筆數</div>
                        <div class="col-md-4 col-sm-4 col-xs-12 bg-white mobile_white">
                            <select class="form_02" id="ShowCount" name="ShowCount">
                                <option value="10">10</option>
                                <option value="30">30</option>
                                <option value="50">50</option>
                                <option value="-1">全部</option>
                            </select>
                        </div>
                        <div class="col-md-6 col-sm-6 hidden-xs bg-white">&nbsp;</div>
                    </div>
                    <div class="form-group bg-grey_1">
                        <div class="col-md-2 col-sm-12 search_item">基本語系設定</div>
                        <div class="col-md-10 col-sm-12 bg-white mobile_white">
                            <div class="row col-md-10" style="margin-left:0px">
                                <div >
                                    <label for="exampleInputFile" class="control-label display_inline" style="float:left;width:100px">序號</label>
                                    @Html.EditorFor(model => model.Column1, new { htmlAttributes = new { @class = "form-control",style= "float:left;width:500px" } })
                                </div>
                            </div>
                            <div class="row col-md-10" style="margin-left:0px">
                                <div>
                                    <label for="exampleInputFile" class="control-label display_inline" style="float:left;width:100px">發佈日期</label>
                                    @Html.EditorFor(model => model.Column2, new { htmlAttributes = new { @class = "form-control", style = "float:left;width:500px" } })
                                </div>
                            </div>
                            <div class="row col-md-10" style="margin-left:0px">
                                <div>
                                    <label for="exampleInputFile" class="control-label display_inline" style="float:left;width:100px">標題</label>
                                    @Html.EditorFor(model => model.Column3, new { htmlAttributes = new { @class = "form-control", style = "float:left;width:500px" } })
                                </div>
                            </div>
                            <div class="row col-md-10" style="margin-left:0px">
                                <div>
                                    <label for="exampleInputFile" class="control-label display_inline" style="float:left;width:100px">類別</label>
                                    @Html.EditorFor(model => model.Column4, new { htmlAttributes = new { @class = "form-control", style = "float:left;width:500px" } })
                                </div>
                            </div>
                            <div class="row col-md-10" style="margin-left:0px">
                                <div>
                                    <label for="exampleInputFile" class="control-label display_inline" style="float:left;width:100px">相關連結</label>
                                    @Html.EditorFor(model => model.Column5, new { htmlAttributes = new { @class = "form-control", style = "float:left;width:500px" } })
                                </div>
                            </div>
                            <div class="row col-md-10" style="margin-left:0px">
                                <div>
                                    <label for="exampleInputFile" class="control-label display_inline" style="float:left;width:100px">檔案下載</label>
                                    @Html.EditorFor(model => model.Column6, new { htmlAttributes = new { @class = "form-control", style = "float:left;width:500px" } })
                                </div>
                            </div>
                            <div class="row col-md-10" style="margin-left:0px">
                                <div>
                                    <label for="exampleInputFile" class="control-label display_inline" style="float:left;width:100px">相關圖片</label>
                                    @Html.EditorFor(model => model.Column7, new { htmlAttributes = new { @class = "form-control", style = "float:left;width:500px" } })
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

            </div>
       
        </div>
    </div>
    <div class="text-center search_padding">
        <button type="submit" class="btn blue" id="btn_submit">確認送出</button>
    </div>
</form>
@section scripts {
    <script>
        $(function () {
            $("#ShowCount").val('@Model.ShowCount');
            $("#eventtable").delegate(".sequence_list", "change", function () {
                var alltr = $("#eventtable tbody tr");
                var nowtridx = $(this).closest('tr').attr('seqidx');
                var newtridx = $(this).val();
                if (newtridx == "0") { newtridx = "1"; }
                if (newtridx == "" || newtridx == nowtridx) {
                    $(this).val(nowtridx);
                    return false;
                }
                var checkint = $(this).val().match(/^[0-9]+$/g);
                if (checkint == null) {
                    $(this).val(nowtridx);
                    return false;
                }
                if (newtridx > alltr.length) { newtridx = alltr.length; }
                if (nowtridx == newtridx.toString()) {
                    $(this).val(nowtridx);
                    return false;
                }

                var nowidxhtml = $(this).closest('tr')[0];
                var addarr = [];

                for (var idx = 1; idx <= alltr.length; idx++) {
                    var nowtr = alltr[idx - 1];
                    if (idx.toString() != nowtridx) {
                        if ((newtridx > nowtridx)) {
                            addarr.push($(nowtr));
                            if (idx == newtridx) {
                                addarr.push($(nowidxhtml));
                            }
                        } else {
                            if (idx == newtridx) {
                                addarr.push($(nowidxhtml));
                            }
                            addarr.push($(nowtr));
                        }
                    }
                }
                $("#eventtable tbody").empty();
                for (var idx = 0; idx < addarr.length; idx++) {
                    $(addarr[idx]).attr("id", "tr_" + idx).attr('seqidx', (idx + 1)).find('.sequence_list').val((idx + 1));
                    $("#eventtable tbody").append(addarr[idx]);
                }
            });

             $("#sel_unit").change(function () {
                if ($("#sel_unit").val() == '1') {
                      var obj = {};
                      obj.mainid = '@Model.MainID'
                      CreatePost('@Url.Action("ModelItem")', obj);
                }else   if ($("#sel_unit").val() == '3') {
                      var obj = {};
                      obj.modelid = '@Model.MainID'
                      CreatePost('@Url.Action("SEOSetting")', obj);
                }
            });
             $('#editform').submit(function (event) {
                 var formData = new FormData();
                 var array = $('#editform').serializeArray();
                 $.each(array, function () {
                     formData.append(this.name, this.value);
                 });
                 var alltr = $("#eventtable tbody tr");
                 for (var idx = 0; idx < alltr.length; idx++) {
                     var columnname = $(alltr[idx]).find('.columnname').text();
                     formData.append("ColumnName[" + idx + "]", columnname);
                     var click = $(alltr[idx]).find('.chkstatus')[0].checked;
                     formData.append("ColumnUse[" + idx + "]", click == true ? 1 : 0);
                 }

                 $.ajax({
                     url: this.action,
                     data: formData,
                     type: 'POST',
                     cache: false,
                     contentType: false,
                     processData: false,
                     success: function (data) {
                         alert(data);
                     }, error: function () {
                         // handle error
                     }
                 });
                 return false;
             });
        });
    </script>

}

